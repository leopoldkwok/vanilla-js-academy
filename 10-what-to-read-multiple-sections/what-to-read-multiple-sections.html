<!DOCTYPE html>
<html>
<head>
	<title>What to read today - multiple sections</title>

	<style type="text/css">
		body {
			margin: 1em auto;
			max-width: 40em;
			width: 88%;
		}

		article {
			margin-bottom: 3em;
		}
	</style>
</head>
<body>

	<h1>What to read today - multiple sections</h1>

	<div id="app"></div>

	<script>
		// Get the app
		var app = document.querySelector('#app');

		// Store API key to a variable for easier access
        var apiKey = 'NEKpCsRpN2bXytM0UJvIEIhbuYS9HiVA';
        
        // get sections
        var sections = ['technology','business','sports'];

        // number of articles
        var numOfArticles = 3;


		/**
		 * Render articles into the DOM
		 * @param  {Array} articles The articles to render
		 */
		var render = function (articles, section) {

			// Create a new array of markup strings with array.map(), then
			// Combine them into one string with array.join(), then
            // Insert them into the DOM with innerHTML
            
			app.innerHTML += '<h2 class="section">' + section + '<h2>' + articles.map(function (article) {
                console.log(app, 'test')
				var html =
					'<article>' +
						'<h2><a href="' + article.url + '">' + article.title + '</a></h2>' +
						'<p>' + article.byline + '</p>' +
						'<p>' + article.abstract + '</p>' +
					'</article>';
				return html;
			}).join('');
		};

		// Get articles
        var getArticles = function(section) {
            fetch('https://api.nytimes.com/svc/topstories/v2/' + section + '.json?api-key=' + apiKey).then(function (response) {
                    if (response.ok) {
                        return response.json();
                    } else {
                        return Promise.reject(response);
                    }
                }).then(function (data) {
                    // Render them into the DOM
                    render(data.results.splice(0, 3), section);
                }).catch(function (error) {
                    console.log('Something went wrong:', error);
                });
        }

        sections.forEach(function(section) {
            getArticles(section);

        })

	</script>
</body>
</html>